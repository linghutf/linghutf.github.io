<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>leetcode-319的算法思考 | 欢迎来到linghutf的博客!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="题目There are n bulbs that are initially off. You first turn on all the bulbs. Then, you turn off every second bulb. On the third round, you toggle every third bulb (turning on if it’s off or turning of">
<meta property="og:type" content="article">
<meta property="og:title" content="leetcode-319的算法思考">
<meta property="og:url" content="http://linghutf.gitcafe.io/2016/01/21/leetcode319/index.html">
<meta property="og:site_name" content="欢迎来到linghutf的博客!">
<meta property="og:description" content="题目There are n bulbs that are initially off. You first turn on all the bulbs. Then, you turn off every second bulb. On the third round, you toggle every third bulb (turning on if it’s off or turning of">
<meta property="og:image" content="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-1.png">
<meta property="og:image" content="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-2.png">
<meta property="og:image" content="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-3.png">
<meta property="og:image" content="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-4.png">
<meta property="og:image" content="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-5.png">
<meta property="og:updated_time" content="2016-04-11T07:39:09.466Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="leetcode-319的算法思考">
<meta name="twitter:description" content="题目There are n bulbs that are initially off. You first turn on all the bulbs. Then, you turn off every second bulb. On the third round, you toggle every third bulb (turning on if it’s off or turning of">
  
    <link rel="alternative" href="/atom.xml" title="欢迎来到linghutf的博客!" type="application/atom+xml">
  
  
    <link rel="icon" href="//img/favicon.jpg">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="//img/Ricciportrait.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">linghutf</a></h1>
        </hgroup>

        
        <p class="header-subtitle">林花谢了春红，太匆匆!</p>
        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives">历史</a></li>
                        
                            <li><a href="/tags">标签</a></li>
                        
                            <li><a href="/categories">分类</a></li>
                        
                            <li><a href="/about">简历</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=PAkNDgsKBQ4MCnxNTRJfU1E" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/linghutf" title="github">github</a>
                            
                                <a class="fl zhihu" target="_blank" href="https://www.zhihu.com/people/linghutf" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo" target="_blank" href="http://weibo.com/linghutf" title="weibo">weibo</a>
                            
                                <a class="fl v2ex" target="_blank" href="https://v2ex.com/member/linghutf" title="v2ex">v2ex</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                                <a class="fl segmentfault" target="_blank" href="http://segmentfault.com/u/linghutf" title="segmentfault">segmentfault</a>
                            
                                <a class="fl douban" target="_blank" href="http://www.douban.com/people/47914461/" title="douban">douban</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/C/" style="font-size: 20px;">C++</a> <a href="/tags/HashMap/" style="font-size: 10px;">HashMap</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Makefile/" style="font-size: 10px;">Makefile</a> <a href="/tags/STL/" style="font-size: 15px;">STL</a> <a href="/tags/ab/" style="font-size: 10px;">ab</a> <a href="/tags/aes/" style="font-size: 10px;">aes</a> <a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/beego/" style="font-size: 10px;">beego</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/diary/" style="font-size: 20px;">diary</a> <a href="/tags/go/" style="font-size: 20px;">go</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/leetcode/" style="font-size: 10px;">leetcode</a> <a href="/tags/mutex/" style="font-size: 10px;">mutex</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/program/" style="font-size: 10px;">program</a> <a href="/tags/program-language/" style="font-size: 10px;">program language</a> <a href="/tags/program-schedule/" style="font-size: 15px;">program schedule</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/server/" style="font-size: 15px;">server</a> <a href="/tags/sort/" style="font-size: 10px;">sort</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/todo/" style="font-size: 20px;">todo</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/webbench/" style="font-size: 10px;">webbench</a> <a href="/tags/基础技术/" style="font-size: 10px;">基础技术</a>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">喜欢历史、文学、代码、数学以及安静的美。</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">linghutf</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="//img/Ricciportrait.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">linghutf</a></h1>
            </hgroup>
            
            <p class="header-subtitle">林花谢了春红，太匆匆!</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives">历史</a></li>
                
                    <li><a href="/tags">标签</a></li>
                
                    <li><a href="/categories">分类</a></li>
                
                    <li><a href="/about">简历</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=PAkNDgsKBQ4MCnxNTRJfU1E" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/linghutf" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="https://www.zhihu.com/people/linghutf" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="http://weibo.com/linghutf" title="weibo">weibo</a>
                    
                        <a class="v2ex" target="_blank" href="https://v2ex.com/member/linghutf" title="v2ex">v2ex</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                        <a class="segmentfault" target="_blank" href="http://segmentfault.com/u/linghutf" title="segmentfault">segmentfault</a>
                    
                        <a class="douban" target="_blank" href="http://www.douban.com/people/47914461/" title="douban">douban</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-leetcode319" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/21/leetcode319/" class="article-date">
      <time datetime="2016-01-21T06:49:47.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      leetcode-319的算法思考
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="u9898_u76EE"><a href="#u9898_u76EE" class="headerlink" title="题目"></a>题目</h2><p>There are n bulbs that are initially off. You first turn on all the bulbs. Then, you turn off every second bulb. On the third round, you toggle every third bulb (turning on if it’s off or turning off if it’s on). For the nth round, you only toggle the last bulb. Find how many bulbs are on after n rounds.</p>
<p>Example:</p>
<p>Given n = 3. </p>
<p>At first, the three bulbs are [off, off, off].<br>After first round, the three bulbs are [on, on, on].<br>After second round, the three bulbs are [on, off, on].<br>After third round, the three bulbs are [on, off, off]. </p>
<p>So you should return 1, because there is only one bulb is on.</p>
<h3 id="u9898_u76EE_u542B_u4E49"><a href="#u9898_u76EE_u542B_u4E49" class="headerlink" title="题目含义"></a>题目含义</h3><p>就是说给n个开关分别对应控制这n个灯泡的亮灭，步骤如下:</p>
<ul>
<li>开始时开关都是关的，为方便叙述，位置从1开始</li>
<li>step=1,将所有位置的开关打开</li>
<li>step=2,将所有位置为2的倍数的开关转换状态</li>
<li>…</li>
<li>step=n,转换完开关后,统计还有多少灯泡开者</li>
</ul>
<hr>
<h1 id="u89E3_u6CD5"><a href="#u89E3_u6CD5" class="headerlink" title="解法"></a>解法</h1><h2 id="1-_u76F4_u89C2_u89E3_u6CD5"><a href="#1-_u76F4_u89C2_u89E3_u6CD5" class="headerlink" title="1.直观解法"></a>1.直观解法</h2><h3 id="u601D_u8DEF"><a href="#u601D_u8DEF" class="headerlink" title="思路"></a>思路</h3><p>分析完题目后,首先想到的就是把开关这些控制流程自己模拟<br>一遍，用布尔数组模拟开关，最后统计为true的开关数就可以<br>了。</p>
<p>那就开始写吧，leetcode支持c/c++，感觉够了，至于能不能<br>用STL库还不清楚，自己动手写一些常用数据结构，虽说性能有<br>损失，但是为了AC,也只能自己注意性能了，尽量不要手动分配<br>大的数组。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bulbswitcher</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">//c99支持的关键字_Bool,ansi不支持,leetcode测试通过</span></span><br><span class="line">    <span class="keyword">_Bool</span> *p=(<span class="keyword">_Bool</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">_Bool</span>)*n);</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//全为false,避免求反时未定义</span></span><br><span class="line">    <span class="built_in">memset</span>(p,<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="keyword">_Bool</span>)*n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;n;++j)&#123;           <span class="comment">//step 1-&gt;n</span></span><br><span class="line">        <span class="keyword">for</span>(i=j;i&lt;n;i+=j+<span class="number">1</span>)&#123;    <span class="comment">//对应的开关,每次跳跃的间隔j+1</span></span><br><span class="line">            *(p+i)=!(*(p+i));   <span class="comment">//不知道编译器是否会优化，所以采用这种直接寻址方式</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//统计为true的开关,如果有c++的accumulate更好</span></span><br><span class="line">    sum(p,n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上传到leetcode jude,不一会儿出现了Limit except，发现它的测试数是10000000,<br>总用时1+s,这么大数字居然超时了.我自己在线下测试的结果：</p>
<ul>
<li><p>普通编译:<br><img src="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-1.png" alt="leetcode-1"></p>
</li>
<li><p>开启-O2 优化<br><img src="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-2.png" alt="leetcode-2"></p>
</li>
</ul>
<p>可以发现这种算法复杂度O(n^2),数字一大性能就不行了。普通编译结果也是超过1s,看来leetcode没有做优化,并且超时时间设置1s,<br>如此只能再想其他解法.</p>
<hr>
<h2 id="2-_u8FDB_u9636_u65B9_u6848"><a href="#2-_u8FDB_u9636_u65B9_u6848" class="headerlink" title="2.进阶方案"></a>2.进阶方案</h2><p>总觉得这样转换的状像是符合某种数学规律，也许是常年的理工教育培养了这种直觉，<br>我就试一试究竟有没有规律,基于现有代码很好改动。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;max;++i)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%3d:%3d\n"</span>,i,bulbswitcher(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>打印结果:<br><img src="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-3.png" alt="leetcode-3"></p>
<p>居然有这么多一样的，看起来像台阶一样，必须满足某种条件才能增加一级.<br>那我再改进一下试探方法,为了一查究竟这么多相同的数字有什么关系，以及开关<br>数n和最后结果的关系，采用哈希表去做，c没有，其实开个大数组也行，我这里用<br>的是Go。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> test(n <span class="typename">int</span>)&#123;</span><br><span class="line">    m:=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="typename">int</span>]<span class="typename">int</span>,n)</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++&#123;</span><br><span class="line">        m[bulbswitcher(i)]++</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//无序表，对key排序    </span></span><br><span class="line">    sort.SortInts(map_keys)</span><br><span class="line">    <span class="keyword">for</span> _,k:=<span class="keyword">range</span> map_keys&#123;</span><br><span class="line">        fmt.Printf(<span class="string">"%3d:%3d\n"</span>,k,m[k])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果:<br><img src="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-4.png" alt="leetcode-4"></p>
<p>果然有关系!原来最后的结果对应的原始开关数n是一个奇数等差数列:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第i级,<span class="keyword">ret</span>表示<span class="keyword">n</span>在这一级内，则最终的结果</span><br><span class="line">cnt表示有多少个<span class="keyword">n</span>是对应<span class="keyword">ret</span>这个结果的，也就是<span class="keyword">n</span>的范围</span><br><span class="line">关系如下:</span><br><span class="line">       2*<span class="keyword">ret</span>+1 = cnt </span><br><span class="line">=&gt;     <span class="keyword">ret</span> = (cnt-1)/2</span><br></pre></td></tr></table></figure></p>
<p>现在我们只要求出这个范围cnt就行了。由于k对应的最后的结果，而v对应n,表明我们需要判断这个n落在哪一级内，<br>也就是将v加起来，直到加到第i级超过n的值，那么n就是在这一级内。<br>基于这种思想有代码:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">magic</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i,cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">3</span>;cnt&lt;n;i+=<span class="number">2</span>)&#123; <span class="comment">//第i级所包含的原始开关数范围,cnt统计n之前的数量</span></span><br><span class="line">        cnt+=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (i-<span class="number">3</span>)&gt;&gt;<span class="number">1</span>;<span class="comment">//因为数列没有cnt=1对应的ret</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>改进之后算法复杂度为O(n/2)=&gt;O(n)，现在上传改进的代码,这次通过了，耗时0s,但是在分布图里，<br>居然只打败了同样用C的6.83%,看来很多人结果比我好啊，也不知道<br>它的测试数字是不是都是一样的。</p>
<p>看一下能不能继续改进。对了，奇数等差数列不是有求和公式吗?我们知道n，直接求它在那一级的范围<br>内，不就是ret的值么?避免了一个个去加然后判断,这就是最终版本的方法。</p>
<h2 id="3-_u6700_u7EC8_u89E3_u6CD5"><a href="#3-_u6700_u7EC8_u89E3_u6CD5" class="headerlink" title="3.最终解法"></a>3.最终解法</h2><p>因为奇数2n-1的求和公式:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">对于上面的关系有:</span><br><span class="line"></span><br><span class="line">         <span class="keyword">sum</span> = (2*<span class="keyword">ret</span>+1+3)*<span class="keyword">ret</span>/2</span><br><span class="line">     =&gt;      =  <span class="keyword">ret</span>*<span class="keyword">ret</span> + 2*<span class="keyword">ret</span></span><br><span class="line"></span><br><span class="line">所以反推有:     </span><br><span class="line">     -&gt;    <span class="keyword">n</span> &lt;= <span class="keyword">ret</span>*<span class="keyword">ret</span></span><br><span class="line">     =&gt;   <span class="keyword">ret</span> = <span class="literal">sqrt</span>(<span class="keyword">n</span>) 向下取整</span><br></pre></td></tr></table></figure></p>
<p>这种解法C函数表示就是<code>floor(sqrt(n))</code><br>所以改进的代码:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">final_magic</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">floor</span>(<span class="built_in">sqrt</span>(n));<span class="comment">//隐式转型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样简单多了。然后上传leetcode测试结果,35个测试全部通过，<br>耗时0ms，居然还是打败6.88%,郁闷</p>
<h2 id="4-_u4E09_u79CD_u89E3_u6CD5_u7684_u5355_u5143_u3001_u6027_u80FD_u6D4B_u8BD5"><a href="#4-_u4E09_u79CD_u89E3_u6CD5_u7684_u5355_u5143_u3001_u6027_u80FD_u6D4B_u8BD5" class="headerlink" title="4.三种解法的单元、性能测试"></a>4.三种解法的单元、性能测试</h2><p>为了测试的方便，我将代码改写成go，然后使用自带test，之前2方案<br>比较快，所以以它为基准测试其他2种正确性。开始的时候都是手写的测试<br>case,用map去对比,本想设置测试上限10000000，但是超过了10分钟，出<br>现了panic，10万以上第一种方法就很慢了。<br>测试代码部分:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>(</span><br><span class="line">    MAX = <span class="number">10000</span>   <span class="comment">//测试范围</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//通用测试方法，传入测试函数参数</span></span><br><span class="line"><span class="keyword">func</span> test(t *testing.T,Func <span class="keyword">func</span>(<span class="typename">int</span>) <span class="typename">int</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;=MAX;i++&#123;</span><br><span class="line">        <span class="keyword">if</span> Func(i)!=Magic(i)&#123;</span><br><span class="line">            <span class="comment">//结果出错</span></span><br><span class="line">            t.Errorf(<span class="string">"%3d:%3d calc failed."</span>,i,Func(i))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">TestCommon(t)&#123;</span><br><span class="line">    test(t,Common)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestFinalMagic(t)</span><br></pre></td></tr></table></figure></p>
<p>性能测试，代码类似:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通用性能测试方法</span></span><br><span class="line"><span class="keyword">func</span> bench(b *testing.B,Func <span class="keyword">func</span>(<span class="typename">int</span>) <span class="typename">int</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;=MAX;i++&#123;</span><br><span class="line">        Func(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BenchmarkCommon(b)</span><br><span class="line">BenchmarkMagic(b)</span><br><span class="line">BenchmarFinalkMagic(b)</span><br></pre></td></tr></table></figure></p>
<p>测试结果:<br><img src="http://7xr8se.com1.z0.glb.clouddn.com/leetcode319-5.png" alt="leetcode-5"></p>
<hr>
<h1 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h1><p>第一种最符合程序员解决问题的思维，也很容易理解。后面的方法已经脱离了问题，变成了纯粹的数学问题<br>无奈第一种性能要差得多。这大概就是提醒我们，抽象生活问题成数学问题，然后去解决它吧。很惭愧，我<br>没有通过分析问题去提炼其中的数学规律，而是凭感觉试出来的，<br>最后，学到的是go中的函数参数了，顺便复习了C语言的一些内容。</p>
<h1 id="u540E_u8BB0"><a href="#u540E_u8BB0" class="headerlink" title="后记"></a>后记</h1><ul>
<li>未改进的版本相比改进版本来说，主要的耗时操作是两重循环，一个是O(N^2),一个是O(1);因此只有在n比较小<br>时，下文针对未改进版本优化才有价值</li>
<li>对于这种状态转换问题，可以使用bitset解决，由于STL对位图的优化，每个状态位只占1个bit,比bool变量都<br>快，而且调式更为方便，效率也比数组高很多。</li>
<li>针对每个数字，能被整除的相应位置反转状态，最后只需要统计其中为1的数量即可</li>
<li>n值小的时候，性能比直接找出规律的方案差不了多少，主要的耗时操作是两重循环，所以这种方案也只有n较小<br>才可行，题目的目的是让我们找出规律，使用O(1)的算法。</li>
<li>最后，代码如下:<script src="https://gist.github.com/linghutf/4a0ab262600edda6f944b3eb95569ee9.js?file=bulbswitch.cc"></script></li>
</ul>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/01/21/leetcode319/">leetcode-319的算法思考</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 linghutf 的个人博客">linghutf</a></p>
        <p><span>发布时间:</span>2016年01月21日 - 14时49分</p>
        <p><span>最后更新:</span>2016年04月11日 - 15时39分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/01/21/leetcode319/" title="leetcode-319的算法思考">http://linghutf.gitcafe.io/2016/01/21/leetcode319/</a>
            <span class="copy-path" data-clipboard-text="原文: http://linghutf.gitcafe.io/2016/01/21/leetcode319/　　作者: linghutf" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2016/01/29/winter-vacation/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          写在放假之前
        
      </div>
    </a>
  
  
    <a href="/2016/01/21/firstsnow/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">2016年第一场雪想到的</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#u9898_u76EE"><span class="toc-number">1.</span> <span class="toc-text">题目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u9898_u76EE_u542B_u4E49"><span class="toc-number">1.1.</span> <span class="toc-text">题目含义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u89E3_u6CD5"><span class="toc-number"></span> <span class="toc-text">解法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-_u76F4_u89C2_u89E3_u6CD5"><span class="toc-number">1.</span> <span class="toc-text">1.直观解法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u601D_u8DEF"><span class="toc-number">1.1.</span> <span class="toc-text">思路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-_u8FDB_u9636_u65B9_u6848"><span class="toc-number">2.</span> <span class="toc-text">2.进阶方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-_u6700_u7EC8_u89E3_u6CD5"><span class="toc-number">3.</span> <span class="toc-text">3.最终解法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-_u4E09_u79CD_u89E3_u6CD5_u7684_u5355_u5143_u3001_u6027_u80FD_u6D4B_u8BD5"><span class="toc-number">4.</span> <span class="toc-text">4.三种解法的单元、性能测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u603B_u7ED3"><span class="toc-number"></span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u540E_u8BB0"><span class="toc-number"></span> <span class="toc-text">后记</span></a>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="2016/01/21/leetcode319/" data-title="leetcode-319的算法思考" data-url="http://linghutf.gitcafe.io/2016/01/21/leetcode319/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"linghutf"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/01/29/winter-vacation/" title="上一篇: 写在放假之前">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2016/01/21/firstsnow/" title="下一篇: 2016年第一场雪想到的">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/03/20/C++11多线程同步互斥初探/">C++11多线程同步互斥初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/10/C++位图排序解决亿级数量问题/">位图解决海量数据排序问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/06/STL的有序和无序哈希容器/">STL的有序和无序哈希容器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/06/Linux下C-C-动态库的生成和加载/">Linux下C/C++动态库的生成和加载</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/06/C++四种转型cast/">C++四种转型cast</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/25/secretsys-md/">个人密码存储在线服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/22/20160222/">在外的元宵节</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/22/springsemister/">进展汇总,新阶段计划</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/29/winter-vacation/">写在放假之前</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/21/leetcode319/">leetcode-319的算法思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/21/firstsnow/">2016年第一场雪想到的</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/11/golangserv/">图片服务器的Nodejs和Go版本性能测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/10/staticfileserv/">静态文件服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/10/schedule/">最近及假期之间的个人计划</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/09/bloghelp/">Hexo静态博客建立指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/09/languages/">关于合适语言的一点看法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/09/factor/">大数阶乘截断</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/08/first_20160108/">我的个人博客终于搭建成功啦!</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/08/latex-20160109/">latex使用小结</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 linghutf
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 21;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>

  </div>
</body>
</html>